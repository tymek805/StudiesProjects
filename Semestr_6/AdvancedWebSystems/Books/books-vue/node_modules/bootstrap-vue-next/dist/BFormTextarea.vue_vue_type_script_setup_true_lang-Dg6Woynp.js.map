{"version":3,"file":"BFormTextarea.vue_vue_type_script_setup_true_lang-Dg6Woynp.js","sources":["../src/components/BFormTextarea/BFormTextarea.vue","../src/composables/useTextareaResize.ts"],"sourcesContent":["<template>\n  <textarea\n    :id=\"computedId\"\n    ref=\"_input\"\n    :key=\"forceUpdateKey\"\n    :class=\"computedClasses\"\n    :name=\"props.name || undefined\"\n    :form=\"props.form || undefined\"\n    :value=\"modelValue ?? undefined\"\n    :disabled=\"props.disabled\"\n    :placeholder=\"props.placeholder\"\n    :required=\"props.required || undefined\"\n    :autocomplete=\"props.autocomplete || undefined\"\n    :readonly=\"props.readonly || props.plaintext\"\n    :aria-required=\"props.required || undefined\"\n    :aria-invalid=\"computedAriaInvalid\"\n    :rows=\"computedRows || 2\"\n    :style=\"computedStyles\"\n    :wrap=\"props.wrap || undefined\"\n    @input=\"\n      (e) => {\n        onInput(e)\n        handleHeightChange()\n      }\n    \"\n    @change=\"onChange\"\n    @blur=\"onBlur\"\n  />\n</template>\n\n<script setup lang=\"ts\">\nimport type {BFormTextareaProps} from '../../types/ComponentProps'\nimport {computed, type CSSProperties, useTemplateRef} from 'vue'\nimport {useDefaults} from '../../composables/useDefaults'\nimport {normalizeInput} from '../../utils/normalizeInput'\nimport {useFormInput} from '../../composables/useFormInput'\nimport {useTextareaResize} from '../../composables/useTextareaResize'\n\nconst _props = withDefaults(defineProps<Omit<BFormTextareaProps, 'modelValue'>>(), {\n  // CommonInputProps\n  ariaInvalid: undefined,\n  autocomplete: undefined,\n  autofocus: false,\n  debounce: 0,\n  debounceMaxWait: NaN,\n  disabled: false,\n  form: undefined,\n  formatter: undefined,\n  id: undefined,\n  lazyFormatter: false,\n  list: undefined,\n  modelValue: '',\n  name: undefined,\n  placeholder: undefined,\n  plaintext: false,\n  readonly: false,\n  required: false,\n  size: undefined,\n  state: undefined,\n  // End CommonInputProps\n  noResize: false,\n  noAutoShrink: false,\n  maxRows: undefined,\n  rows: 2,\n  wrap: 'soft',\n})\nconst props = useDefaults(_props, 'BFormTextarea')\n\nconst [modelValue, modelModifiers] = defineModel<\n  Exclude<BFormTextareaProps['modelValue'], undefined>,\n  'trim' | 'lazy' | 'number'\n>({\n  default: '',\n  set: (v) => normalizeInput(v, modelModifiers),\n})\n\nconst input = useTemplateRef<HTMLTextAreaElement>('_input')\n\nconst {\n  computedId,\n  forceUpdateKey,\n  computedAriaInvalid,\n  onInput,\n  stateClass,\n  onChange,\n  onBlur,\n  focus,\n  blur,\n} = useFormInput(props, input, modelValue, modelModifiers)\n\nconst computedClasses = computed(() => [\n  stateClass.value,\n  props.plaintext ? 'form-control-plaintext' : 'form-control',\n  {\n    [`form-control-${props.size}`]: !!props.size,\n  },\n])\n\nconst {\n  computedStyles: resizeStyles,\n  onInput: handleHeightChange,\n  computedRows,\n} = useTextareaResize(\n  input,\n  computed(() => ({\n    maxRows: props.maxRows,\n    rows: props.rows,\n    noAutoShrink: props.noAutoShrink,\n  }))\n)\n\nconst computedStyles = computed<CSSProperties>(() => ({\n  resize: props.noResize ? 'none' : undefined,\n  ...(props.maxRows || props.noAutoShrink ? resizeStyles.value : undefined),\n}))\n\ndefineExpose({\n  blur,\n  element: input,\n  focus,\n})\n</script>\n","import {useToNumber} from '@vueuse/core'\nimport type {Numberish} from '../types/CommonTypes'\nimport {\n  computed,\n  type CSSProperties,\n  type MaybeRefOrGetter,\n  nextTick,\n  onMounted,\n  readonly,\n  ref,\n  type ShallowRef,\n  toRef,\n} from 'vue'\nimport {isVisible} from '../utils/dom'\n\nexport const useTextareaResize = (\n  input: Readonly<ShallowRef<HTMLTextAreaElement | null>>,\n  props: MaybeRefOrGetter<{\n    rows: Numberish\n    maxRows: Numberish | undefined\n    noAutoShrink: boolean\n  }>\n) => {\n  const height = ref<number | null | string>(0)\n  const resolvedProps = readonly(toRef(props))\n  const maxRowsNumber = useToNumber(() => resolvedProps.value.maxRows || NaN, {\n    method: 'parseInt',\n    nanToZero: true,\n  })\n  const rowsNumber = useToNumber(() => resolvedProps.value.rows || NaN, {\n    method: 'parseInt',\n    nanToZero: true,\n  })\n  const computedMinRows = computed(() => Math.max(rowsNumber.value || 2, 2))\n  const computedMaxRows = computed(() => Math.max(computedMinRows.value, maxRowsNumber.value || 0))\n  const computedRows = computed(() =>\n    computedMinRows.value === computedMaxRows.value ? computedMinRows.value : null\n  )\n\n  const handleHeightChange = async () => {\n    // Element must be visible (not hidden) and in document\n    // Must be checked after above checks\n    if (!input.value || !isVisible(input.value)) {\n      height.value = null\n      return\n    }\n\n    // Get current computed styles\n    const computedStyle = getComputedStyle(input.value)\n    // Height of one line of text in px\n    const lineHeight = Number.parseFloat(computedStyle.lineHeight) || 1\n    // Calculate height of border and padding\n    const border =\n      (Number.parseFloat(computedStyle.borderTopWidth) || 0) +\n      (Number.parseFloat(computedStyle.borderBottomWidth) || 0)\n    const padding =\n      (Number.parseFloat(computedStyle.paddingTop) || 0) +\n      (Number.parseFloat(computedStyle.paddingBottom) || 0)\n    // Calculate offset\n    const offset = border + padding\n    // Minimum height for min rows (which must be 2 rows or greater for cross-browser support)\n    const minHeight = lineHeight * computedMinRows.value + offset\n\n    // Get the current style height (with `px` units)\n    const oldHeight = input.value.style.height || computedStyle.height\n    // Probe scrollHeight by temporarily changing the height to `auto`\n    height.value = 'auto'\n    await nextTick() // We need to wait for the dom to update. These cannot be batched in the same tick\n    const {scrollHeight} = input.value\n    // Place the original old height back on the element, just in case `computedProp`\n    // returns the same value as before\n    height.value = oldHeight\n    await nextTick() // We need to wait for the dom to update. These cannot be batched in the same tick\n\n    // Calculate content height in 'rows' (scrollHeight includes padding but not border)\n    const contentRows = Math.max((scrollHeight - padding) / lineHeight, 2)\n    // Calculate number of rows to display (limited within min/max rows)\n    const rows = Math.min(Math.max(contentRows, computedMinRows.value), computedMaxRows.value)\n    // Calculate the required height of the textarea including border and padding (in pixels)\n    const newHeight = Math.max(Math.ceil(rows * lineHeight + offset), minHeight)\n\n    // Computed height remains the larger of `oldHeight` and new `height`,\n    // when height is in `sticky` mode (prop `no-auto-shrink` is true)\n    if (\n      resolvedProps.value.noAutoShrink &&\n      (Number.parseFloat(oldHeight.toString()) || 0) > newHeight\n    ) {\n      height.value = oldHeight\n      return\n    }\n\n    // Return the new computed CSS height in px units\n    height.value = `${newHeight}px`\n  }\n\n  onMounted(handleHeightChange)\n\n  const computedStyles = computed<CSSProperties>(() => ({\n    resize: 'none',\n    height:\n      typeof height.value === 'string'\n        ? height.value\n        : height.value\n          ? `${height.value}px`\n          : undefined,\n  }))\n\n  return {\n    onInput: handleHeightChange,\n    computedStyles,\n    computedRows,\n  }\n}\n"],"names":["_props","__props","props","useDefaults","modelValue","modelModifiers","_useModel","set","v","normalizeInput","input","useTemplateRef","computedId","forceUpdateKey","computedAriaInvalid","onInput","stateClass","onChange","onBlur","focus","blur","useFormInput","computedClasses","computed","value","plaintext","size","computedStyles","resizeStyles","handleHeightChange","computedRows","height","ref","resolvedProps","readonly","toRef","maxRowsNumber","useToNumber","maxRows","NaN","method","nanToZero","rowsNumber","rows","computedMinRows","Math","max","computedMaxRows","async","isVisible","computedStyle","getComputedStyle","lineHeight","Number","parseFloat","border","borderTopWidth","borderBottomWidth","padding","paddingTop","paddingBottom","offset","minHeight","oldHeight","style","nextTick","scrollHeight","contentRows","min","newHeight","ceil","noAutoShrink","toString","onMounted","resize","useTextareaResize","noResize","__expose","element"],"mappings":"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"}